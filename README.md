# duplicate

**Механизм работы**:
1. Создается лид.
2. Запускается поиск лида по номеру телефона / почте. Если уже есть существующий лид, который находится в работе, то из него получаем ответственного и дату создания. 
3. Если разница во времени создания между новым лидом и существующим больше 1 часа, то такой лид не является дублем. Если между ними разница меньше 1 часа, то новый лид автоматически меняет свой этап на "Дубль". В существущий лид ставится задача, что от клиента поступила новая заявка и ссылка на дублирующий лид.
4. Далее согласно логике бизнеса запускаются отдельные бизнес-процессы на базе Битрикс24.

**Как запустить**:
1. duplicate.php и auth.php необходимо разместить на хостинге с поддержкой SSL.
2. В файле auth.php необходимо прописать данные портала.
3. В строке 108 в 'TEMPLATE_ID' необходимо указать ID бизнес-процесса, который необходимо запустить, если лид не является дублем.
4. В строке 137 необходимо указать ID стадии лида, в которую будет перемещаться лид, если он является дублем.
5. Делаем POST запрос посредством конструкции Webhook* через робот, или бизнес-процессом: https://yourdomain.com/path/duplicate.php?lead=123&phone=7900XXXXXXX&email=test@test.ru&commentLead=Комментарий лида

**Переменные передаваемые в POST запросе:**
yourdomain.com - URL хостинга с поддержкой SSL.
path - путь до скрипта.
lead - ID нового лида.
phone - телефон в новом лиде.
email - почта в новом лиде.
commentLead - комментарий в новом лиде.


*Подробнее о действии Webhook можно почитать тут: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=57&LESSON_ID=8551
